{% extends 'base.html' %}
{% from 'macros/table.html' import book_table, author_table, publisher_table, language_table, stats_card %}

{% block title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏</h1>
    
    
    <div class="row mb-5">
        {{ stats_card("–í—Å–µ–≥–æ –∫–Ω–∏–≥", total_stats.total_books, "bi-book", "primary") }}
        {{ stats_card("–í—Å–µ–≥–æ –∞–≤—Ç–æ—Ä–æ–≤", total_stats.total_authors, "bi-person", "success") }}
        {{ stats_card("–í—Å–µ–≥–æ –∏–∑–¥–∞—Ç–µ–ª–µ–π", total_stats.total_publishers, "bi-building", "warning") }}
        {{ stats_card("–Ø–∑—ã–∫–∏", total_stats.total_languages, "bi-globe", "info") }}
    </div>
    
    
    <div class="card mb-5">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h3 class="mb-0">üìö –ö–Ω–∏–≥–∏</h3>
            <span class="badge bg-light text-dark">{{ books|length }} –∫–Ω–∏–≥</span>
        </div>
        <div class="card-body">
            {{ book_table(books, show_actions=false) }}
            
            
            {% if books.has_other_pages() %}
            <nav class="mt-4">
                <ul class="pagination justify-content-center">
                    {% if books.has_previous() %}
                    <li class="page-item">
                        <a class="page-link" href="?books_page={{ books.previous_page_number() }}{% if authors_page %}&authors_page={{ authors_page }}{% endif %}{% if publishers_page %}&publishers_page={{ publishers_page }}{% endif %}{% if languages_page %}&languages_page={{ languages_page }}{% endif %}">
                            &laquo; –ù–∞–∑–∞–¥
                        </a>
                    </li>
                    {% endif %}
                    
                    <li class="page-item disabled">
                        <span class="page-link">
                            –ö–Ω–∏–≥–∏: {{ books.number }} –∏–∑ {{ books.paginator.num_pages }}
                        </span>
                    </li>
                    
                    {% if books.has_next() %}
                    <li class="page-item">
                        <a class="page-link" href="?books_page={{ books.next_page_number() }}{% if authors_page %}&authors_page={{ authors_page }}{% endif %}{% if publishers_page %}&publishers_page={{ publishers_page }}{% endif %}{% if languages_page %}&languages_page={{ languages_page }}{% endif %}">
                            –í–ø–µ—Ä–µ–¥ &raquo;
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        </div>
    </div>
    
    <div class="row">
        
        <div class="col-lg-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">üë• –ê–≤—Ç–æ—Ä—ã</h3>
                    <span class="badge bg-light text-dark">{{ authors.paginator.count }} –∞–≤—Ç–æ—Ä–æ–≤</span>
                </div>
                <div class="card-body">
                    {{ author_table(authors) }}
                    
                    
                    {% if authors.has_other_pages() %}
                    <nav class="mt-4">
                        <ul class="pagination justify-content-center">
                            {% if authors.has_previous() %}
                            <li class="page-item">
                                <a class="page-link" href="?authors_page={{ authors.previous_page_number() }}{% if books_page %}&books_page={{ books_page }}{% endif %}{% if publishers_page %}&publishers_page={{ publishers_page }}{% endif %}{% if languages_page %}&languages_page={{ languages_page }}{% endif %}">
                                    &laquo;
                                </a>
                            </li>
                            {% endif %}
                            
                            <li class="page-item disabled">
                                <span class="page-link">
                                    {{ authors.number }} / {{ authors.paginator.num_pages }}
                                </span>
                            </li>
                            
                            {% if authors.has_next() %}
                            <li class="page-item">
                                <a class="page-link" href="?authors_page={{ authors.next_page_number() }}{% if books_page %}&books_page={{ books_page }}{% endif %}{% if publishers_page %}&publishers_page={{ publishers_page }}{% endif %}{% if languages_page %}&languages_page={{ languages_page }}{% endif %}">
                                    &raquo;
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </nav>
                    {% endif %}
                </div>
            </div>
        </div>
        
        
        <div class="col-lg-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-warning text-white d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">üè¢ –ò–∑–¥–∞—Ç–µ–ª–∏</h3>
                    <span class="badge bg-light text-dark">{{ publishers.paginator.count }} –∏–∑–¥–∞—Ç–µ–ª–µ–π</span>
                </div>
                <div class="card-body">
                    {{ publisher_table(publishers) }}
                    
                    
                    {% if publishers.has_other_pages() %}
                    <nav class="mt-4">
                        <ul class="pagination justify-content-center">
                            {% if publishers.has_previous() %}
                            <li class="page-item">
                                <a class="page-link" href="?publishers_page={{ publishers.previous_page_number() }}{% if books_page %}&books_page={{ books_page }}{% endif %}{% if authors_page %}&authors_page={{ authors_page }}{% endif %}{% if languages_page %}&languages_page={{ languages_page }}{% endif %}">
                                    &laquo;
                                </a>
                            </li>
                            {% endif %}
                            
                            <li class="page-item disabled">
                                <span class="page-link">
                                    {{ publishers.number }} / {{ publishers.paginator.num_pages }}
                                </span>
                            </li>
                            
                            {% if publishers.has_next() %}
                            <li class="page-item">
                                <a class="page-link" href="?publishers_page={{ publishers.next_page_number() }}{% if books_page %}&books_page={{ books_page }}{% endif %}{% if authors_page %}&authors_page={{ authors_page }}{% endif %}{% if languages_page %}&languages_page={{ languages_page }}{% endif %}">
                                    &raquo;
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </nav>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    
    <div class="card mb-5">
        <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
            <h3 class="mb-0">üåê –Ø–∑—ã–∫–∏</h3>
            <span class="badge bg-light text-dark">{{ languages.paginator.count }} —è–∑—ã–∫–æ–≤</span>
        </div>
        <div class="card-body">
            {{ language_table(languages) }}
            
            
            {% if languages.has_other_pages() %}
            <nav class="mt-4">
                <ul class="pagination justify-content-center">
                    {% if languages.has_previous() %}
                    <li class="page-item">
                        <a class="page-link" href="?languages_page={{ languages.previous_page_number() }}{% if books_page %}&books_page={{ books_page }}{% endif %}{% if authors_page %}&authors_page={{ authors_page }}{% endif %}{% if publishers_page %}&publishers_page={{ publishers_page }}{% endif %}">
                            &laquo; –ù–∞–∑–∞–¥
                        </a>
                    </li>
                    {% endif %}
                    
                    <li class="page-item disabled">
                        <span class="page-link">
                            –Ø–∑—ã–∫–∏: {{ languages.number }} –∏–∑ {{ languages.paginator.num_pages }}
                        </span>
                    </li>
                    
                    {% if languages.has_next() %}
                    <li class="page-item">
                        <a class="page-link" href="?languages_page={{ languages.next_page_number() }}{% if books_page %}&books_page={{ books_page }}{% endif %}{% if authors_page %}&authors_page={{ authors_page }}{% endif %}{% if publishers_page %}&publishers_page={{ publishers_page }}{% endif %}">
                            –í–ø–µ—Ä–µ–¥ &raquo;
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        </div>
    </div>
    
    
    <div class="row mt-3">
        <div class="col-md-4">
            {{ stats_card("–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥", overall_stats.avg_rating|floatformat(2) or "0.00", "bi-star", "primary") }}
        </div>
        <div class="col-md-4">
            {{ stats_card("–í—Å–µ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü", overall_stats.total_pages or 0, "bi-file-text", "success") }}
        </div>
        <div class="col-md-4">
            {{ stats_card("–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª-–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü", overall_stats.avg_pages|floatformat(0) or 0, "bi-file-earmark", "warning") }}
        </div>
    </div>
    
    
    <div class="text-center mt-4">
        <a href="{{ url('statistics') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-clockwise"></i> –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('books_page') || urlParams.has('authors_page') || 
        urlParams.has('publishers_page') || urlParams.has('languages_page')) {
        
        
        document.querySelector('.card').scrollIntoView({ behavior: 'smooth' });
    }
});
</script>
{% endblock %}