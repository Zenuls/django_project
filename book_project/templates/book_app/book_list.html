{% extends 'base.html' %}

{% block title %}–°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥{% endblock %}

{% block content %}
<h1 class="mb-4">–°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥</h1>

<div class="mb-4">
    <form method="get" class="row g-3">
        <div class="col-md-6">
            <input type="text" name="search" class="form-control" 
                   placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞–≤—Ç–æ—Ä—É..." 
                   value="{{ request.GET.get('search', '') }}">
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">–ù–∞–π—Ç–∏</button>
        </div>
        <div class="col-md-2">
            <a href="{{ url('book_list') }}" class="btn btn-secondary w-100">–°–±—Ä–æ—Å–∏—Ç—å</a>
        </div>
        <div class="col-md-2">
            <a href="{{ url('book_create') }}" class="btn btn-success w-100">–î–æ–±–∞–≤–∏—Ç—å</a>
        </div>
    </form>
</div>

{% if books %}
<div class="table-responsive">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–ê–≤—Ç–æ—Ä—ã</th>
                <th>–ò–∑–¥–∞—Ç–µ–ª—å</th>
                <th>–†–µ–π—Ç–∏–Ω–≥</th>
                <th>–°—Ç—Ä–∞–Ω–∏—Ü</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for book in books %}
            <tr>
                <td>{{ book.book_id }}</td>
                <td>{{ book.title|truncatechars(50) }}</td>
                <td>{{ book.author_names|truncatechars(40) }}</td>
                <td>
                    {% if book.publisher %}
                        {{ book.publisher.publisher_name|truncatechars(30) }}
                    {% else %}
                        ‚Äî
                    {% endif %}
                </td>
                <td>
                    {% if book.rating %}
                        {{ book.rating.average_rating|floatformat(2) }}
                    {% else %}
                        ‚Äî
                    {% endif %}
                </td>
                <td>{{ book.num_pages|default("‚Äî") }}</td>
                <td>
                    
                    <a href="{{ url('book_update', book.pk) }}" class="btn btn-sm btn-warning" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                        ‚úèÔ∏è
                    </a>
                    <a href="{{ url('book_delete', book.pk) }}" class="btn btn-sm btn-danger" title="–£–¥–∞–ª–∏—Ç—å">
                        üóëÔ∏è
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


{% if page_obj.has_other_pages() %}
<nav class="mt-4">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous() %}
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number() }}{% if request.GET.get('search') %}&search={{ request.GET.get('search') }}{% endif %}">
                –ù–∞–∑–∞–¥
            </a>
        </li>
        {% endif %}
        
        <li class="page-item disabled">
            <span class="page-link">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
            </span>
        </li>
        
        {% if page_obj.has_next() %}
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number() }}{% if request.GET.get('search') %}&search={{ request.GET.get('search') }}{% endif %}">
                –í–ø–µ—Ä–µ–¥
            </a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endif %}

{% else %}
<div class="alert alert-info">
    <p class="mb-0">–ö–Ω–∏–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
</div>
{% endif %}
{% endblock %}